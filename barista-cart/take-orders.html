<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee Cart</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f4f4f4;
            min-height: 100vh;
        }

        nav {
            background: #333;
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-title {
            font-size: 1.5rem;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .nav-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            color: white;
        }

        .portal-btn {
            background-color: #4CAF50;
        }

        .view-btn {
            background-color: #2196F3;
        }

        .logout-btn {
            background-color: #f44336;
        }

        .page-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .order-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section-title {
            margin-bottom: 20px;
            color: #333;
        }

        .coffee-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .coffee-btn {
            background: white;
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .coffee-btn:hover {
            border-color: #2196F3;
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.2);
            transform: translateY(-2px);
        }

        .coffee-btn.selected {
            background-color: white;
            color: #2196F3;
            border: 2px solid #2196F3;
            box-shadow: 0 0 0 4px rgba(33, 150, 243, 0.2);
        }

        .current-order {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .place-order-btn {
            width: 100%;
            padding: 1rem;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
        }

        .place-order-btn:hover {
            background: #45a049;
        }

        .order-number {
            margin-bottom: 20px;
        }

        .order-number input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .copyright {
            position: fixed;
            bottom: 10px;
            left: 10px;
            color: #666;
            font-size: 0.8rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .modal-content h2 {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }

        .order-options {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .number-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .number-control button {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
        }

        .number-control span {
            min-width: 30px;
            text-align: center;
        }

        .milk-options, .extra-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .special-instructions textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 5px;
            resize: vertical;
        }

        .add-to-cart-btn {
            width: 100%;
            padding: 12px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
        }

        .add-to-cart-btn:hover {
            background: #1976D2;
        }

        .custom-alert {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .alert-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .alert-content p {
            margin-bottom: 20px;
            font-size: 1.1rem;
            color: #333;
        }

        .alert-content button {
            padding: 8px 20px;
            border: none;
            border-radius: 4px;
            background: #2196F3;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            min-width: 100px;
        }

        .confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .confirm-buttons button:first-child {
            background: #4CAF50;
        }

        .confirm-buttons button:last-child {
            background: #f44336;
        }

        .success .alert-content {
            border-left: 4px solid #4CAF50;
        }

        .macchiato-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .other-coffee {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .other-coffee input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 5px;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-title">Coffee Cart</div>
        <div class="nav-buttons">
            <button class="nav-btn portal-btn">Barista Portal</button>
            <button class="nav-btn logout-btn">Logout</button>
        </div>
    </nav>

    <div class="page-content">
        <div class="order-section">
            <h2 class="section-title">New Order</h2>
            <div class="coffee-grid">
                <button class="coffee-btn">Flat White</button>
                <button class="coffee-btn">Cappuccino</button>
                <button class="coffee-btn">Short Black</button>
                <button class="coffee-btn">Long Black</button>
                <button class="coffee-btn">Americano</button>
                <button class="coffee-btn">Latte</button>
                <button class="coffee-btn">Espresso</button>
                <button class="coffee-btn">Macchiato</button>
                <button class="coffee-btn">Mocha</button>
                <button class="coffee-btn">Iced Coffee/Latte</button>
                <button class="coffee-btn">Hot Chocolate</button>
                <button class="coffee-btn">Other</button>
            </div>
        </div>

        <div class="current-order">
            <h2 class="section-title">Current Order</h2>
            <div class="order-number">
                <input type="number" placeholder="Order Number" min="1" max="999">
            </div>
            <div id="orderDetails">
                <!-- Order details will be displayed here -->
            </div>
            <button class="place-order-btn">Place Order</button>
        </div>
    </div>

    <div id="orderModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Flat White</h2>
            
            <div class="order-options">
                <div class="quantity-section">
                    <label>Quantity</label>
                    <div class="number-control">
                        <button type="button" onclick="adjustQuantity(-1)">-</button>
                        <span id="quantityDisplay">1</span>
                        <button type="button" onclick="adjustQuantity(1)">+</button>
                    </div>
                </div>

                <div class="sugar-section">
                    <label>Sugar</label>
                    <div class="number-control">
                        <button type="button" onclick="adjustSugar(-1)">-</button>
                        <span id="sugarDisplay">0</span>
                        <button type="button" onclick="adjustSugar(1)">+</button>
                    </div>
                </div>

                <div class="milk-options">
                    <div class="checkbox-group">
                        <input type="checkbox" id="fullCream">
                        <label for="fullCream">Full Cream</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="almond">
                        <label for="almond">Almond</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="oat">
                        <label for="oat">Oat</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="soy">
                        <label for="soy">Soy</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="skim">
                        <label for="skim">Skim</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="lactose">
                        <label for="lactose">Lactose Free</label>
                    </div>
                </div>

                <div class="extra-options">
                    <div class="checkbox-group">
                        <input type="checkbox" id="extraHot">
                        <label for="extraHot">Extra Hot</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="doubleShot">
                        <label for="doubleShot">Double Shot</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="halfStrength">
                        <label for="halfStrength">Half Strength</label>
                    </div>
                </div>

                <div id="macchiatoOptions" class="macchiato-options" style="display: none;">
                    <div class="checkbox-group">
                        <input type="checkbox" id="toppedUp">
                        <label for="toppedUp">Topped Up</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="short">
                        <label for="short">Short</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="long">
                        <label for="long">Long</label>
                    </div>
                </div>

                <div id="otherCoffeeInput" class="other-coffee" style="display: none;">
                    <label>Coffee Name</label>
                    <input type="text" id="customCoffeeName" placeholder="Enter coffee name">
                </div>

                <div class="special-instructions">
                    <label>Other</label>
                    <textarea id="specialInstructions" rows="3"></textarea>
                </div>
            </div>

            <button id="addToCart" class="add-to-cart-btn">Add to cart</button>
        </div>
    </div>

    <div class="copyright">
        Copyright 2025 Jordan Bartleman v1
    </div>

    <div id="customAlert" class="custom-alert">
        <div class="alert-content">
            <p id="alertMessage"></p>
            <button onclick="closeAlert()">OK</button>
        </div>
    </div>

    <div id="confirmDialog" class="custom-alert">
        <div class="alert-content">
            <p>Are you sure you want to place this order?</p>
            <div class="confirm-buttons">
                <button onclick="confirmOrder(true)">Yes</button>
                <button onclick="confirmOrder(false)">No</button>
            </div>
        </div>
    </div>

    <div id="successAlert" class="custom-alert success">
        <div class="alert-content">
            <p>Order placed successfully!</p>
            <button onclick="closeAlert()">OK</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCrnqJIS84ZmBylRBYNrDRg8FwRNmkfLwQ",
            authDomain: "barista-f1e71.firebaseapp.com",
            databaseURL: "https://barista-f1e71-default-rtdb.firebaseio.com",
            projectId: "barista-f1e71",
            storageBucket: "barista-f1e71.firebasestorage.app",
            messagingSenderId: "169547083412",
            appId: "1:169547083412:web:991d2e52ed46e8b023ce81",
            measurementId: "G-QR1NHK2J1R"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        auth.onAuthStateChanged((user) => {
            if (!user && !sessionStorage.getItem('userLoggedIn')) {
                window.location.href = 'login.html';
                return;
            }
        });

        document.querySelector('.logout-btn').addEventListener('click', () => {
            signOut(auth).then(() => {
                sessionStorage.clear();
                window.location.href = 'login.html';
            });
        });

        document.querySelector('.portal-btn').addEventListener('click', () => {
            sessionStorage.setItem('viewingBarista', 'true');
            window.location.href = 'barista-view.html';
        });

        document.querySelectorAll('.coffee-btn').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.coffee-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                this.classList.add('selected');
                
                const modal = document.getElementById('orderModal');
                const modalTitle = document.getElementById('modalTitle');
                modalTitle.textContent = this.textContent;

                const macchiatoOptions = document.getElementById('macchiatoOptions');
                const otherCoffeeInput = document.getElementById('otherCoffeeInput');
                
                if (this.textContent === 'Macchiato') {
                    macchiatoOptions.style.display = 'grid';
                    otherCoffeeInput.style.display = 'none';
                } else if (this.textContent === 'Other') {
                    macchiatoOptions.style.display = 'none';
                    otherCoffeeInput.style.display = 'block';
                } else {
                    macchiatoOptions.style.display = 'none';
                    otherCoffeeInput.style.display = 'none';
                }
                
                modal.style.display = 'block';
            });
        });

        onValue(ref(db, 'orders'), (snapshot) => {
            const orders = snapshot.val();
            const activeOrders = document.getElementById('activeOrders');
            activeOrders.innerHTML = '';

            if (orders) {
                const ordersArray = Object.entries(orders)
                    .map(([key, order]) => ({key, ...order}))
                    .sort((a, b) => b.timestamp - a.timestamp);

                ordersArray.forEach(order => {
                    const orderCard = document.createElement('div');
                    orderCard.className = `order-card ${order.status === 'completed' ? 'completed' : ''}`;
                    orderCard.innerHTML = `
                        <h3>Order #${order.number}</h3>
                        <div class="order-status ${order.status}">${order.status}</div>
                        <p><strong>Coffee:</strong> ${order.coffee}</p>
                        <p><strong>Milk:</strong> ${order.milk}</p>
                        <p><strong>Sugar:</strong> ${order.sugar}</p>
                        ${order.extraHot ? '<p><strong>Extra Hot</strong></p>' : ''}
                        ${order.specialInstructions ? `<p><strong>Special:</strong> ${order.specialInstructions}</p>` : ''}
                        <div class="order-buttons">
                            <button class="complete-btn ${order.status === 'completed' ? 'completed' : ''}" 
                                    onclick="completeOrder('${order.key}')"
                                    ${order.status === 'completed' ? 'disabled' : ''}>
                                ${order.status === 'completed' ? 'Order Completed' : 'Complete Order'}
                            </button>
                            <button class="remove-btn" onclick="removeOrder('${order.key}')">
                                Remove
                            </button>
                        </div>
                    `;
                    activeOrders.appendChild(orderCard);
                });
            }
        });

        window.completeOrder = function(orderKey) {
            const orderRef = ref(db, 'orders/' + orderKey);
            update(orderRef, {
                status: 'completed'
            }).catch((error) => {
                console.error('Error completing order:', error);
            });
        };

        window.removeOrder = function(orderKey) {
            if (confirm('Are you sure you want to remove this order?')) {
                remove(ref(db, 'orders/' + orderKey))
                    .catch((error) => {
                        console.error('Error removing order:', error);
                    });
            }
        };

        window.addEventListener('click', (e) => {
            const modal = document.getElementById('orderModal');
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });

        window.adjustQuantity = function(change) {
            const display = document.getElementById('quantityDisplay');
            let value = parseInt(display.textContent);
            value = Math.max(1, Math.min(10, value + change));
            display.textContent = value;
        };

        window.adjustSugar = function(change) {
            const display = document.getElementById('sugarDisplay');
            let value = parseInt(display.textContent);
            value = Math.max(0, Math.min(6, value + change));
            display.textContent = value;
        };

        function updateOrderDetails(orderDetails) {
            const orderDetailsDiv = document.getElementById('orderDetails');
            let milkTypes = Object.entries(orderDetails.milk)
                .filter(([_, checked]) => checked)
                .map(([type]) => type)
                .join(', ');

            const orderHtml = `
                <div class="order-item">
                    <p><strong>${orderDetails.quantity}x ${orderDetails.coffee}</strong></p>
                    ${milkTypes ? `<p>Milk: ${milkTypes}</p>` : ''}
                    ${orderDetails.sugar > 0 ? `<p>Sugar: ${orderDetails.sugar}</p>` : ''}
                    ${orderDetails.extraHot ? '<p>Extra Hot</p>' : ''}
                    ${orderDetails.doubleShot ? '<p>Double Shot</p>' : ''}
                    ${orderDetails.halfStrength ? '<p>Half Strength</p>' : ''}
                    ${orderDetails.toppedUp ? '<p>Topped Up</p>' : ''}
                    ${orderDetails.short ? '<p>Short</p>' : ''}
                    ${orderDetails.long ? '<p>Long</p>' : ''}
                    ${orderDetails.specialInstructions ? `<p>Special: ${orderDetails.specialInstructions}</p>` : ''}
                    <button class="remove-item-btn" onclick="removeOrderItem(this)">Remove</button>
                </div>
            `;

            orderDetailsDiv.innerHTML += orderHtml;
            
            const currentOrders = JSON.parse(localStorage.getItem('currentOrders') || '[]');
            currentOrders.push(orderDetails);
            localStorage.setItem('currentOrders', JSON.stringify(currentOrders));
        }

        window.removeOrderItem = function(button) {
            const orderItem = button.parentElement;
            const orderDetails = document.getElementById('orderDetails');
            const index = Array.from(orderDetails.children).indexOf(orderItem);
            
            const currentOrders = JSON.parse(localStorage.getItem('currentOrders') || '[]');
            currentOrders.splice(index, 1);
            localStorage.setItem('currentOrders', JSON.stringify(currentOrders));
            
            orderItem.remove();
        };

        document.getElementById('addToCart').addEventListener('click', () => {
            let coffeeName = document.getElementById('modalTitle').textContent;
            
            if (coffeeName === 'Other') {
                const customName = document.getElementById('customCoffeeName').value;
                if (!customName.trim()) {
                    showAlert('Please enter a coffee name');
                    return;
                }
                coffeeName = customName;
            }

            const orderDetails = {
                coffee: coffeeName,
                quantity: document.getElementById('quantityDisplay').textContent,
                sugar: document.getElementById('sugarDisplay').textContent,
                milk: {
                    fullCream: document.getElementById('fullCream').checked,
                    almond: document.getElementById('almond').checked,
                    oat: document.getElementById('oat').checked,
                    soy: document.getElementById('soy').checked,
                    skim: document.getElementById('skim').checked,
                    lactose: document.getElementById('lactose').checked
                },
                extraHot: document.getElementById('extraHot').checked,
                doubleShot: document.getElementById('doubleShot').checked,
                halfStrength: document.getElementById('halfStrength').checked,
                toppedUp: document.getElementById('toppedUp')?.checked || false,
                short: document.getElementById('short')?.checked || false,
                long: document.getElementById('long')?.checked || false,
                specialInstructions: document.getElementById('specialInstructions').value
            };

            updateOrderDetails(orderDetails);

            document.getElementById('orderModal').style.display = 'none';
            document.getElementById('specialInstructions').value = '';
            document.getElementById('customCoffeeName').value = '';
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
            document.getElementById('quantityDisplay').textContent = '1';
            document.getElementById('sugarDisplay').textContent = '0';
        });

        function showAlert(message) {
            const alert = document.getElementById('customAlert');
            const alertMessage = document.getElementById('alertMessage');
            alertMessage.textContent = message;
            alert.style.display = 'flex';
        }

        function showSuccess() {
            const success = document.getElementById('successAlert');
            success.style.display = 'flex';
        }

        function showConfirm() {
            const confirm = document.getElementById('confirmDialog');
            confirm.style.display = 'flex';
        }

        function closeAlert() {
            document.getElementById('customAlert').style.display = 'none';
            document.getElementById('successAlert').style.display = 'none';
            document.getElementById('confirmDialog').style.display = 'none';
        }

        window.closeAlert = closeAlert;

        let currentOrderNumber = parseInt(localStorage.getItem('lastOrderNumber') || '0');

        function updateOrderNumberInput() {
            document.querySelector('.order-number input').value = currentOrderNumber + 1;
        }

        updateOrderNumberInput();

        window.confirmOrder = async function(confirmed) {
            if (!confirmed) {
                closeAlert();
                return;
            }

            const orderNumberInput = document.querySelector('.order-number input');
            const orderNumber = orderNumberInput.value;
            const currentOrders = JSON.parse(localStorage.getItem('currentOrders') || '[]');

            if (!orderNumber) {
                showAlert('Please enter an order number');
                return;
            }

            if (currentOrders.length === 0) {
                showAlert('Please add items to your order');
                return;
            }

            try {
                const ordersRef = ref(db, 'orders');
                await push(ordersRef, {
                    number: orderNumber,
                    timestamp: Date.now(),
                    status: 'pending',
                    items: currentOrders
                });

                currentOrderNumber = parseInt(orderNumber);
                localStorage.setItem('lastOrderNumber', currentOrderNumber);

                document.getElementById('orderDetails').innerHTML = '';
                localStorage.removeItem('currentOrders');
                
                updateOrderNumberInput();
                
                closeAlert();
                showSuccess();
            } catch (error) {
                console.error('Error placing order:', error);
                closeAlert();
                showAlert('Error placing order: ' + error.message);
            }
        };

        document.querySelector('.order-number input').addEventListener('input', function(e) {
            if (e.target.value) {
                currentOrderNumber = parseInt(e.target.value) - 1;
            }
        });

        document.querySelector('.place-order-btn').addEventListener('click', () => {
            const orderNumber = document.querySelector('.order-number input').value;
            if (!orderNumber) {
                showAlert('Please enter an order number');
                return;
            }

            const currentOrders = JSON.parse(localStorage.getItem('currentOrders') || '[]');
            if (currentOrders.length === 0) {
                showAlert('Please add items to your order');
                return;
            }

            showConfirm();
        });
    </script>
</body>
</html> 